<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Formulaire de commande</title>
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 10px;
      background: #f9f9f9;
    }
    form {
      background: white;
      padding: 15px;
      border-radius: 10px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 15px;
    }
    select, input, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    button {
      background-color: #28a745;
      color: white;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>

  <form id="order-form">
    <h2>Commande</h2>

    <label for="prenom">Prénom</label>
    <input type="text" id="prenom" name="prenom" required />

    <label for="nom">Nom</label>
    <input type="text" id="nom" name="nom" required />

    <label for="email">Email</label>
    <input type="email" id="email" name="email" required />

    <label for="wilaya">Adresse de livraison</label>
    <select id="wilaya" name="wilaya" required>
      <option value="">-- Sélectionnez votre wilaya --</option>
      <!-- Wilayas 1 à 58 -->
      <script>
        const wilayas = [
          "Adrar", "Chlef", "Laghouat", "Oum El Bouaghi", "Batna", "Béjaïa", "Biskra", "Béchar", "Blida", "Bouira",
          "Tamanrasset", "Tébessa", "Tlemcen", "Tiaret", "Tizi Ouzou", "Alger", "Djelfa", "Jijel", "Sétif", "Saïda",
          "Skikda", "Sidi Bel Abbès", "Annaba", "Guelma", "Constantine", "Médéa", "Mostaganem", "M’Sila", "Mascara", "Ouargla",
          "Oran", "El Bayadh", "Illizi", "Bordj Bou Arréridj", "Boumerdès", "El Tarf", "Tindouf", "Tissemsilt", "El Oued", "Khenchela",
          "Souk Ahras", "Tipaza", "Mila", "Aïn Defla", "Naâma", "Aïn Témouchent", "Ghardaïa", "Relizane", "Timimoun", "Bordj Badji Mokhtar",
          "Ouled Djellal", "Béni Abbès", "In Salah", "In Guezzam", "Touggourt", "Djanet", "El M’Ghair", "El Meniaa"
        ];
        document.addEventListener('DOMContentLoaded', () => {
          const wilayaSelect = document.getElementById("wilaya");
          wilayas.forEach((name, index) => {
            const option = document.createElement("option");
            option.value = `${index + 1} - ${name}`;
            option.textContent = `${index + 1} - ${name}`;
            wilayaSelect.appendChild(option);
          });
        });
      </script>
    </select>

    <label for="produit">Produit</label>
    <select id="produit" name="produit" required>
      <option value="Routeur">Routeur</option>
      <option value="Switch">Switch</option>
      <option value="Câble FTP">Câble FTP</option>
      <option value="Point d'accès">Point d'accès</option>
    </select>

    <label for="quantite">Quantité</label>
    <select id="quantite" name="quantite" required></select>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const quantiteSelect = document.getElementById("quantite");
        for (let i = 1; i <= 100; i++) {
          const option = document.createElement("option");
          option.value = i;
          option.text = i;
          quantiteSelect.appendChild(option);
        }
      });
    </script>

    <button type="submit">Envoyer la commande</button>
  </form>

  <script>
    emailjs.init("PRWN5poGo1YbcMfmq");

    document.getElementById("order-form").addEventListener("submit", function (e) {
      e.preventDefault();

      const form = this;
      const formData = new FormData(form);

      const data = {
        prenom: formData.get("prenom"),
        nom: formData.get("nom"),
        email: formData.get("email"),
        wilaya: formData.get("wilaya"),
        produit: formData.get("produit"),
        quantite: formData.get("quantite"),
        page: window.location.href,
        date: new Date().toLocaleString(),
        ip: "masquée",
        localisation: "masquée"
      };

      fetch("https://api.ipinfo.io/json?token=30b8520dc83c25")
        .then((res) => res.json())
        .then((ipdata) => {
          data.ip = "masqué";
          data.localisation = "masqué";

          return emailjs.send("service_ck03zot", "template_99pjvzj", data);
        })
        .then(() => {
          alert("Commande envoyée avec succès !");
          form.reset();
        })
        .catch((error) => {
          console.error("Erreur :", error);
          alert("Erreur lors de l'envoi. Veuillez réessayer.");
        });
    });
  </script>

</body>
</html>
